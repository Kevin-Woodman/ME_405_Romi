<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Mecha_15 (Zippy): Mecha_15 (Zippy)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Mecha_15 (Zippy)
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('index.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Mecha_15 (Zippy) </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="ss_intro"></a>
Introduction</h1>
<p>The Romi Project tasked teams of two students with developing a Micropython-based, autonomous, two-wheel-drive robot which competed in time-trials of a fixed track. The project exercised a holistic view of the mechatronics discipline, incorporating elements of mechanical design, electrical engineering, computer science, and control theory. Each team was given equal foundation for development: a Romi Chassis Kit equipped with a Motor Driver and Power Distribution Board from Pololu Robotics, and a Nucleo-L476RG development board from ST electronics connected to a custom extension board, the Shoe of Brian.</p>
<p>[Hardware Render]</p>
<p>The game track, shown in a birds-eye view below, provided a diverse array of obstacles for Romi to navigate.</p>
<div class="image">
<img src="BlankGameTrack.jpg" alt="" width="75%"/>
</div>
<p> Deliberately, few rules were outlined to allow for creative solutions to the course’s challenges. Romi robots were required to begin within the 2D confines of the grey starting square and contact all checkpoints (denoted by labeled black dots) in numbered order before returning at least their geometric center to within the starting square to complete a time trial. The only additional rule required that the robot detect the wall adjacent to the starting square at some point during the run. Finally, two zones housed an object that, if displaced outside of the dotted regions, would yield a five second time deduction each for the trial.</p>
<h1><a class="anchor" id="ss_hardware"></a>
Hardware</h1>
<p>The team’s Romi affectionately nicknamed “Zippy,” was developed in ten weeks and includes a 9-DOF IMU, 13-unit IR reflectance sensor array, tactile switch bump sensor, HC-05 Bluetooth module, and 20kg positional servo, in addition to the provided MCU and Motor Driver/PDB development boards.</p>
<p>[Romi Photo]</p>
<p>This section serves to break down each hardware component individually and provides a brief description of the purpose and implementation of each.</p>
<h2><a class="anchor" id="ss_wiring_diagram"></a>
Wiring Diagram</h2>
<div class="image">
<img src="Final Wiring Diagram.jpg" alt="" width="75%"/>
</div>
<h1><a class="anchor" id="ss_overview"></a>
Overview</h1>
<h2><a class="anchor" id="ss_tasks"></a>
Tasks</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Task Name   </th><th class="markdownTableHeadNone">Task Function   </th><th class="markdownTableHeadNone">Task Priority   </th><th class="markdownTableHeadNone">Task Period [us]    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Control   </td><td class="markdownTableBodyNone">Controller.Controller.task   </td><td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone">10    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Tracker   </td><td class="markdownTableBodyNone"><a class="el" href="class_tracker_1_1_tracker.html#a3bff04c7937a927d0e38feafbaef5b62" title="Defines the task for Controller.">Tracker.Tracker.task</a>   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">20    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DriveR   </td><td class="markdownTableBodyNone"><a class="el" href="class_motor_encoder_task_1_1_motor_encoder.html#aeb15e1c948fc972b95dcb391b7631f59" title="Defines the task for MotorEncoder.">MotorEncoderTask.MotorEncoder.task</a>   </td><td class="markdownTableBodyNone">3   </td><td class="markdownTableBodyNone">5    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">DriveL   </td><td class="markdownTableBodyNone"><a class="el" href="class_motor_encoder_task_1_1_motor_encoder.html#aeb15e1c948fc972b95dcb391b7631f59" title="Defines the task for MotorEncoder.">MotorEncoderTask.MotorEncoder.task</a>   </td><td class="markdownTableBodyNone">3   </td><td class="markdownTableBodyNone">5   </td></tr>
</table>
<div class="image">
<img src="FinalTaskDiagram.jpg" alt="" width="50%"/>
</div>
<h2><a class="anchor" id="ss_track"></a>
Track</h2>
<div class="image">
<img src="Gametrack Diagram.jpg" alt="" width="75%"/>
</div>
<h2><a class="anchor" id="ss_bluetooth"></a>
Bluetooth module</h2>
<p>Romi uses HC-05 Wireless Bluetooth Receiver connected to UART 5. The below code mirrors Micropython's tty to UART 5. This allows micropython to communicate over the bluetooth module. </p><div class="fragment"><div class="line"><span class="comment"># Bluetooth Configuration</span></div>
<div class="line">uart = pyb.UART(5, 115200)</div>
<div class="line">uart.init(115200, bits=8, parity=<span class="keywordtype">None</span>, stop=1)</div>
<div class="line">pyb.repl_uart(uart)</div>
</div><!-- fragment --><h2><a class="anchor" id="ss_battery"></a>
Battery Voltage Adjustor</h2>
<p>Because the motors are effort based instead of voltage based as Romi's batteries drain the motors will behave differently. To account for this Romi contains a voltage divider which is used in conjunction with an ADC pin to measure the current battery voltage. The following code is located in <a class="el" href="main_8py.html">main.py</a> </p><div class="fragment"><div class="line">batPin = ADC(Pin.board.PB0)</div>
<div class="line">Vbat = batPin.read() * (3.3 / 4095) * (58 / 20) * 1.125</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (Vbat &lt;= 6.65):</div>
<div class="line">    <span class="comment"># If we are low on charge</span></div>
<div class="line">    print(<span class="stringliteral">&quot;CHARGE BATTERIES&quot;</span>)</div>
<div class="line">    exit(0)</div>
</div><!-- fragment --><p>The current voltage is then used to calculate motor effort from the desired velocity. The following code is located in <a class="el" href="_motor_encoder_task_8py.html">MotorEncoderTask.py</a> </p><div class="fragment"><div class="line">self.motor.set_effort(voltage/Vbat * 100)</div>
</div><!-- fragment --><p> Operating in voltage allows Romi to directly use motor gain for feedforwarding </p><div class="fragment"><div class="line">motorGain = 5.57  <span class="comment"># (rad/s)/V</span></div>
<div class="line">offset = 2.1  <span class="comment"># Offset to overcome static friction.</span></div>
<div class="line">self.vel2volt = <span class="keyword">lambda</span> vel: ((vel / motorGain) + offset * (-1 <span class="keywordflow">if</span> vel &lt; 0 <span class="keywordflow">else</span> 1))</div>
</div><!-- fragment --> </div></div><!-- PageDoc -->
<a href="doxygen_crawl.html"></a>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
